generator client {
  provider      = "prisma-client-js"
  output        = "../models"
  binaryTargets = ["native", "windows", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model clients {
  id            String          @id(map: "client_id") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email         String
  password      String?
  profile       Json?           @default("{}")
  deleted_at    DateTime?       @db.Timestamptz(6)
  ai_task       ai_task[]
  auth_tokens   auth_tokens[]
  organizations organizations[]
}

model organizations {
  id         String    @id(map: "organization_id") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  id_client  String    @db.Uuid
  name       String
  data       Json
  questions  Json
  deleted_at DateTime? @db.Timestamptz(6)
  onboard    Json      @default("{\"qa\": false, \"profile\": false}")
  client     clients   @relation(fields: [id_client], references: [id], onDelete: Cascade)
}

model ai_task {
  id                 String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  id_client          String       @db.Uuid
  worker_script_path String
  status             AITaskStatus @default(PENDING)
  created_at         DateTime     @default(now())
  updated_at         DateTime     @updatedAt
  input              Json         @db.Json
  last_error         Json?        @db.Json
  last_progress      Json?        @db.Json
  name               String
  output             Json?        @db.Json
  client             clients      @relation(fields: [id_client], references: [id], onDelete: Cascade)
}

model auth_tokens {
  id         String    @id(map: "sessions_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id  String    @db.Uuid
  token      String    @unique(map: "sessions_token_key")
  expires_at DateTime  @db.Timestamptz(6)
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamptz(6)
  user_agent String?
  ip_address String?
  clients    clients   @relation(fields: [client_id], references: [id], onDelete: Cascade, map: "sessions_client_id_fkey")
}

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
// model session_lines {
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
// model sessions {
// }

enum AITaskStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  INTERRUPTED
  INVALID_WORKER_PATH
}
